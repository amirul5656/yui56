#!/bin/bash
echo "üì¶ Menginstal dependensi..."
apt-get update && apt-get install -y screen wget git tar

# Membuat 5 huruf acak
RAND=$(tr -dc A-Za-z0-9 </dev/urandom | head -c 5)

echo "üìÅ Menyimpan skrip mining ke /root/web.sh..."
cat << EOF > /root/web.sh
#!/bin/bash

cd /root || exit

# Download miner jika belum ada
if [ ! -f /root/yui56/web ]; then
  echo "‚¨áÔ∏è Mengunduh file web..."
  git clone https://github.com/amirul5656/yui56.git /root/yui56
  chmod +x /root/yui56/web
fi

# Konfigurasi core untuk 3 instance (8 thread per instance)
declare -A CORES
CORES[1]="0-7"
CORES[2]="8-15"
CORES[3]="16-23"

for i in 1 2 3; do
  SCREEN_NAME="amirul\${i}-${RAND}"
  if screen -list | grep -q "\${SCREEN_NAME}"; then
    echo "‚ö†Ô∏è  Screen '\${SCREEN_NAME}' sudah jalan, skip."
  else
    echo "‚ñ∂ Menjalankan mining di screen '\${SCREEN_NAME}'..."
    screen -dmS "\${SCREEN_NAME}" bash -c '
      while true; do
        taskset -c ${CORES[$i]} /root/yui56/web -a power2b -o stratum+tcp://power2b.eu.mine.zpool.ca:6242 -u ltc1q682mxnytl67x3gdw8eezxpuq4pehz5qhax4ls5 -p c=LTC -t 8
        sleep 2
      done
    '
  fi
done
EOF

chmod +x /root/web.sh

echo "üöÄ Menjalankan miner sekarang..."
bash /root/web.sh

echo "‚úÖ Siap! Mining aktif sekarang di 3 screen, masing-masing pakai 8 thread."
